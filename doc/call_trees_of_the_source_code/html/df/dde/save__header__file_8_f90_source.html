<!-- custom-made header -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>SPECFEM3D_GLOBE: SPECFEM3D_GLOBE/src/shared/save_header_file.F90 Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../defaultstyle.css" rel="stylesheet" type="text/css" />
<link href="../../mystyle.css" rel="stylesheet" type="text/css"/>
<!-- Loading Lato Font -->
<link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;"> <!--  <td style="padding-left: 0.5em;"> -->
   <div id="projectname">SPECFEM3D_GLOBE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('df/dde/save__header__file_8_f90_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">save_header_file.F90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../df/dde/save__header__file_8_f90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">!=====================================================================</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">!          S p e c f e m 3 D  G l o b e  V e r s i o n  7 . 0</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">!          --------------------------------------------------</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">!     Main historical authors: Dimitri Komatitsch and Jeroen Tromp</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">!                        Princeton University, USA</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">!                and CNRS / University of Marseille, France</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">!                 (there are currently many more authors!)</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">! (c) Princeton University and CNRS / University of Marseille, April 2014</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">! This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">! it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">! the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">! (at your option) any later version.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">! This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">! but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">! GNU General Public License for more details.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">! You should have received a copy of the GNU General Public License along</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">! with this program; if not, write to the Free Software Foundation, Inc.,</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">! 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">!=====================================================================</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">! save header file OUTPUT_FILES/values_from_mesher.h</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">  subroutine </span><a class="code" href="../../df/dde/save__header__file_8_f90.html#a4363853726f81e0cf4c3d52760b73b00">save_header_file</a>(NSPEC,NGLOB,NPROC,NPROCTOT, &amp;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;                              static_memory_size, &amp;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                              nspec2d_top,nspec2d_bottom, &amp;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;                              nspec2dmax_ymin_ymax,nspec2dmax_xmin_xmax, &amp;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;                              nspecmax_aniso_ic,nspecmax_iso_mantle,nspecmax_tiso_mantle, &amp;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                              nspecmax_aniso_mantle,nspec_crust_mantle_attenuation, &amp;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;                              nspec_inner_core_attenuation, &amp;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                              nspec_crust_mantle_str_or_att,nspec_inner_core_str_or_att, &amp;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                              nspec_crust_mantle_str_and_att,nspec_inner_core_str_and_att, &amp;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                              nspec_crust_mantle_strain_only,nspec_inner_core_strain_only, &amp;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                              nspec_crust_mantle_adjoint, &amp;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                              nspec_outer_core_adjoint,nspec_inner_core_adjoint, &amp;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                              nglob_crust_mantle_adjoint,nglob_outer_core_adjoint, &amp;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                              nglob_inner_core_adjoint,nspec_outer_core_rot_adjoint, &amp;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                              nspec_crust_mantle_stacey,nspec_outer_core_stacey, &amp;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                              nglob_crust_mantle_oceans,nspec_outer_core_rotation,nt_dump_attenuation_optimal, &amp;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                              print_info_to_screen)</div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="../../df/dde/save__header__file_8_f90.html#a4363853726f81e0cf4c3d52760b73b00">   47</a></span>&#160;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">! Daniel note: the comment below is wrong, since e.g. NSPEC_CRUST_MANTLE_ADJOINT is either 1 (dummy value)</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">!              for SIMULATION_TYPE == 1 or equal to NSPEC_CRUST_MANTLE for SIMULATION_TYPE == 3 or SAVE_FORWARD set to .true.</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">!              the value is determined in routine memory_eval() and passed here as argument.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">!              thus, in order to be able to run a kernel simulation, users still have to re-compile the binaries with the right</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">!              parameters set in Par_file otherwise the kernel runs will crash.</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">!              there is hardly another way of this usage when trying to take advantage of static compilation for the solver.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">!              please ignore the following remark:</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">! ****************************************************************************************************</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">! IMPORTANT: this routine must *NOT* use flag SIMULATION_TYPE (nor SAVE_FORWARD), i.e. none of the parameters it computes</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">! should depend on SIMULATION_TYPE, because most users do not recompile the code nor rerun the mesher</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">! when switching from SIMULATION_TYPE == 1 to SIMULATION_TYPE == 3 and thus the header file created</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">! by this routine would become wrong in the case of a run with SIMULATION_TYPE == 3 if the code</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">! was compiled with SIMULATION_TYPE == 1</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">! ****************************************************************************************************</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordtype">use </span><a class="code" href="../../d7/d28/namespaceconstants.html">constants</a></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">use </span><a class="code" href="../../d5/d7b/namespaceshared__parameters.html">shared_parameters</a><span class="keywordtype">, only</span>: topography, &amp;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    transverse_isotropy,anisotropic_3d_mantle,anisotropic_inner_core, &amp;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    ellipticity,gravity,rotation, &amp;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    oceans,attenuation,attenuation_3d, &amp;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    angular_width_xi_in_degrees,angular_width_eta_in_degrees,nchunks, &amp;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    include_central_cube,center_longitude_in_degrees, &amp;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    center_latitude_in_degrees,gamma_rotation_azimuth, &amp;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    dt,nex_xi,nex_eta, &amp;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    nproc_xi,nproc_eta, &amp;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    save_regular_kl, &amp;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    partial_phys_dispersion_only, &amp;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    absorbing_conditions,exact_mass_matrix_for_rotation, &amp;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    att1,att2,att3,att4,att5, &amp;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    movie_volume,movie_volume_type,ntstep_between_frames,simulation_type,movie_surface, &amp;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    undo_attenuation,memory_installed_per_core_in_gb,nex_per_proc_xi,nex_per_proc_eta, &amp;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    this_region_has_a_doubling,doubling_index,ner,ratio_sampling_array, &amp;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    record_length_in_minutes,nstep</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(MAX_NUM_REGIONS)</span> :: NSPEC,NGLOB</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordtype">integer</span> :: NPROC,NPROCTOT,NT_DUMP_ATTENUATION_optimal</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="comment">! static memory size needed by the solver</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keywordtype">double precision</span> :: static_memory_size</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(MAX_NUM_REGIONS)</span> :: &amp;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        NSPEC2D_TOP,NSPEC2D_BOTTOM,NSPEC2DMAX_YMIN_YMAX,NSPEC2DMAX_XMIN_XMAX</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordtype">integer</span> :: NSPECMAX_ANISO_IC,NSPECMAX_ISO_MANTLE,NSPECMAX_TISO_MANTLE, &amp;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;         NSPECMAX_ANISO_MANTLE,NSPEC_CRUST_MANTLE_ATTENUATION, &amp;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;         NSPEC_INNER_CORE_ATTENUATION, &amp;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;         NSPEC_CRUST_MANTLE_STR_OR_ATT,NSPEC_INNER_CORE_STR_OR_ATT, &amp;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;         NSPEC_CRUST_MANTLE_STR_AND_ATT,NSPEC_INNER_CORE_STR_AND_ATT, &amp;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;         NSPEC_CRUST_MANTLE_STRAIN_ONLY,NSPEC_INNER_CORE_STRAIN_ONLY, &amp;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;         NSPEC_CRUST_MANTLE_ADJOINT, &amp;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;         NSPEC_OUTER_CORE_ADJOINT,NSPEC_INNER_CORE_ADJOINT, &amp;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;         NGLOB_CRUST_MANTLE_ADJOINT,NGLOB_OUTER_CORE_ADJOINT, &amp;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;         NGLOB_INNER_CORE_ADJOINT,NSPEC_OUTER_CORE_ROT_ADJOINT, &amp;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;         NSPEC_CRUST_MANTLE_STACEY,NSPEC_OUTER_CORE_STACEY, &amp;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;         NGLOB_CRUST_MANTLE_OCEANS,NSPEC_OUTER_CORE_ROTATION, &amp;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;         NSPEC2D_MOHO, NSPEC2D_400, NSPEC2D_670, NSPEC2D_CMB, NSPEC2D_ICB</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordtype">integer</span> :: NGLOB_XY_CM, NGLOB_XY_IC</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">! local parameters</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordtype">double precision</span> :: subtract_central_cube_elems,subtract_central_cube_points</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">! for regional code</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keywordtype">double precision</span> x,y,gamma,rgt,xi,eta</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordtype">double precision</span> x_top,y_top,z_top</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <span class="keywordtype">double precision</span> ANGULAR_WIDTH_XI_RAD,ANGULAR_WIDTH_ETA_RAD</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">! rotation matrix from Euler angles</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordtype">integer</span> i,j,ix,iy,icorner</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordtype">double precision</span> rotation_matrix(3,3)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  <span class="keywordtype">double precision</span> vector_ori(3),vector_rotated(3)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordtype">double precision</span> r_corner,theta_corner,phi_corner,lat,long,colat_corner</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordtype">integer</span> :: ier</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordtype">integer</span> :: num_elem_gc,num_gll_gc</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordtype">double precision</span> :: avg_dist_deg,avg_dist_km,avg_element_size</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">!! DK DK for UNDO_ATTENUATION</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keywordtype">integer</span> :: saved_SIMULATION_TYPE</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordtype">integer</span> :: number_of_dumpings_to_do</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordtype">double precision</span> :: static_memory_size_GB,size_to_store_at_each_time_step,disk_size_of_each_dumping</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordtype">logical</span> :: PRINT_INFO_TO_SCREEN</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">! evaluate the amount of static memory needed by the solver</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keyword">call </span><a class="code" href="../../d2/d2a/memory__eval_8f90.html#a8e678cc09ae49efba061153da060fb20">memory_eval</a>(doubling_index,this_region_has_a_doubling, &amp;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                   ner,nex_per_proc_xi,nex_per_proc_eta, &amp;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                   ratio_sampling_array,nproctot,nspec,nglob, &amp;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                   nspecmax_aniso_ic,nspecmax_iso_mantle,nspecmax_tiso_mantle, &amp;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                   nspecmax_aniso_mantle,nspec_crust_mantle_attenuation, &amp;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                   nspec_inner_core_attenuation, &amp;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                   nspec_crust_mantle_str_or_att,nspec_inner_core_str_or_att, &amp;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                   nspec_crust_mantle_str_and_att,nspec_inner_core_str_and_att, &amp;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                   nspec_crust_mantle_strain_only,nspec_inner_core_strain_only, &amp;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                   nspec_crust_mantle_adjoint, &amp;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                   nspec_outer_core_adjoint,nspec_inner_core_adjoint, &amp;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                   nglob_crust_mantle_adjoint,nglob_outer_core_adjoint, &amp;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                   nglob_inner_core_adjoint,nspec_outer_core_rot_adjoint, &amp;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                   nspec_crust_mantle_stacey,nspec_outer_core_stacey, &amp;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                   nglob_crust_mantle_oceans,nspec_outer_core_rotation, &amp;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                   nspec2d_bottom,nspec2d_top,static_memory_size)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordflow">if</span> (print_info_to_screen) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    print *</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    print *,<span class="stringliteral">&#39;edit file OUTPUT_FILES/values_from_mesher.h to see&#39;</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    print *,<span class="stringliteral">&#39;some statistics about the mesh&#39;</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    print *</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    print *,<span class="stringliteral">&#39;number of processors = &#39;</span>,nproctot</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    print *</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    print *,<span class="stringliteral">&#39;maximum number of points per region = &#39;</span>,nglob(iregion_crust_mantle)</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    print *</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    print *,<span class="stringliteral">&#39;total elements per slice = &#39;</span>,sum(nspec)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    print *,<span class="stringliteral">&#39;total points per slice = &#39;</span>,sum(nglob)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    print *</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    print *,<span class="stringliteral">&#39;the time step of the solver will be DT = &#39;</span>,sngl(dt),<span class="stringliteral">&#39; (s)&#39;</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    print *,<span class="stringliteral">&#39;the (approximate) minimum period resolved will be = &#39;</span>, &amp;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            sngl(max(angular_width_eta_in_degrees,angular_width_xi_in_degrees)/90.0 * 256.0/min(nex_eta,nex_xi) * 17.0),<span class="stringliteral">&#39; (s)&#39;</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    print *</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    print *,<span class="stringliteral">&#39;current record length is = &#39;</span>,sngl(record_length_in_minutes),<span class="stringliteral">&#39;min&#39;</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    print *,<span class="stringliteral">&#39;current minimum number of time steps will be = &#39;</span>,nstep</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    print *</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> (movie_surface .or. movie_volume) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      print *,<span class="stringliteral">&#39;MOVIE_VOLUME :&#39;</span>,movie_volume</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      print *,<span class="stringliteral">&#39;MOVIE_SURFACE:&#39;</span>,movie_surface</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      print *,<span class="stringliteral">&#39;Saving movie frames every&#39;</span>,ntstep_between_frames</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      print *</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    print *,<span class="stringliteral">&#39;on NEC SX, make sure &quot;loopcnt=&quot; parameter&#39;</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">! use fused loops on NEC SX</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    print *,<span class="stringliteral">&#39;in Makefile is greater than max vector length = &#39;</span>,nglob(iregion_crust_mantle)*ndim</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    print *</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    print *,<span class="stringliteral">&#39;approximate static memory needed by the solver:&#39;</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    print *,<span class="stringliteral">&#39;----------------------------------------------&#39;</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    print *</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    print *,<span class="stringliteral">&#39;(lower bound, usually the real amount used is 5% to 10% higher)&#39;</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    print *</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    print *,<span class="stringliteral">&#39;(you can get a more precise estimate of the size used per MPI process&#39;</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    print *,<span class="stringliteral">&#39; by typing &quot;size -d bin/xspecfem3D&quot;&#39;</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    print *,<span class="stringliteral">&#39; after compiling the code with the DATA/Par_file you plan to use)&#39;</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    print *</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    print *,<span class="stringliteral">&#39;size of static arrays per slice = &#39;</span>,static_memory_size/1.d6,<span class="stringliteral">&#39; MB&#39;</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    print *,<span class="stringliteral">&#39;                                = &#39;</span>,static_memory_size/1048576.d0,<span class="stringliteral">&#39; MiB&#39;</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    print *,<span class="stringliteral">&#39;                                = &#39;</span>,static_memory_size/1.d9,<span class="stringliteral">&#39; GB&#39;</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    print *,<span class="stringliteral">&#39;                                = &#39;</span>,static_memory_size/1073741824.d0,<span class="stringliteral">&#39; GiB&#39;</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    print *</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">! note: using less memory becomes an issue only if the strong scaling of the code is poor.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">!          Some users will run simulations with an executable using far less than 80% RAM per core</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">!          if they prefer having a faster computational time (and use a higher number of cores).</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    print *,<span class="stringliteral">&#39;   (should be below 80% or 90% of the memory installed per core)&#39;</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    print *,<span class="stringliteral">&#39;   (if significantly more, the job will not run by lack of memory)&#39;</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    print *,<span class="stringliteral">&#39;   (note that if significantly less, you waste a significant amount&#39;</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    print *,<span class="stringliteral">&#39;    of memory per processor core)&#39;</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    print *,<span class="stringliteral">&#39;   (but that can be perfectly acceptable if you can afford it and&#39;</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    print *,<span class="stringliteral">&#39;    want faster results by using more cores)&#39;</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    print *</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> (static_memory_size*dble(nproctot)/1.d6 &lt; 10000.d0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      print *,<span class="stringliteral">&#39;size of static arrays for all slices = &#39;</span>,static_memory_size*dble(nproctot)/1.d6,<span class="stringliteral">&#39; MB&#39;</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      print *,<span class="stringliteral">&#39;                                     = &#39;</span>,static_memory_size*dble(nproctot)/1048576.d0,<span class="stringliteral">&#39; MiB&#39;</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      print *,<span class="stringliteral">&#39;                                     = &#39;</span>,static_memory_size*dble(nproctot)/1.d9,<span class="stringliteral">&#39; GB&#39;</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      print *,<span class="stringliteral">&#39;size of static arrays for all slices = &#39;</span>,static_memory_size*dble(nproctot)/1.d9,<span class="stringliteral">&#39; GB&#39;</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    print *,<span class="stringliteral">&#39;                                     = &#39;</span>,static_memory_size*dble(nproctot)/1073741824.d0,<span class="stringliteral">&#39; GiB&#39;</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    print *,<span class="stringliteral">&#39;                                     = &#39;</span>,static_memory_size*dble(nproctot)/1.d12,<span class="stringliteral">&#39; TB&#39;</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    print *,<span class="stringliteral">&#39;                                     = &#39;</span>,static_memory_size*dble(nproctot)/1099511627776.d0,<span class="stringliteral">&#39; TiB&#39;</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    print *</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="keywordflow">  endif</span> <span class="comment">! of if (PRINT_INFO_TO_SCREEN)</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="comment">! note: we will always calculate the value for NT_DUMP_ATTENUATION_optimal even if it will not be used</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  <span class="comment">!       this will avoid the need to recompile the solver if one wants to switch between simulations</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">!       with UNDO_ATTENUATION set to .true. or .false.</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="comment">! optimal dumping interval calculation can only be done when SIMULATION_TYPE == 3 in the Par_file,</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="comment">! thus set it to that value here in this serial code even if it has a different value in the Par_file</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  saved_simulation_type = simulation_type</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  simulation_type = 3</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <span class="comment">! evaluate the amount of static memory needed by the solver, but imposing that SIMULATION_TYPE = 3</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">! because that is by far the most expensive setup for runs in terms of memory usage, thus that is</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="comment">! the type of run for which we need to make sure that everything fits in memory</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keyword">call </span><a class="code" href="../../d2/d2a/memory__eval_8f90.html#a8e678cc09ae49efba061153da060fb20">memory_eval</a>(doubling_index,this_region_has_a_doubling, &amp;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                   ner,nex_per_proc_xi,nex_per_proc_eta, &amp;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                   ratio_sampling_array,nproctot,nspec,nglob, &amp;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                   nspecmax_aniso_ic,nspecmax_iso_mantle,nspecmax_tiso_mantle, &amp;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                   nspecmax_aniso_mantle,nspec_crust_mantle_attenuation, &amp;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                   nspec_inner_core_attenuation, &amp;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                   nspec_crust_mantle_str_or_att,nspec_inner_core_str_or_att, &amp;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                   nspec_crust_mantle_str_and_att,nspec_inner_core_str_and_att, &amp;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                   nspec_crust_mantle_strain_only,nspec_inner_core_strain_only, &amp;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                   nspec_crust_mantle_adjoint, &amp;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                   nspec_outer_core_adjoint,nspec_inner_core_adjoint, &amp;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                   nglob_crust_mantle_adjoint,nglob_outer_core_adjoint, &amp;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                   nglob_inner_core_adjoint,nspec_outer_core_rot_adjoint, &amp;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                   nspec_crust_mantle_stacey,nspec_outer_core_stacey, &amp;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                   nglob_crust_mantle_oceans,nspec_outer_core_rotation, &amp;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                   nspec2d_bottom,nspec2d_top,static_memory_size)</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keyword">call </span><a class="code" href="../../df/dde/save__header__file_8_f90.html#a082f59ac5e4681ee2fb74b9f60765482">compute_optimized_dumping</a>(static_memory_size,nt_dump_attenuation_optimal,number_of_dumpings_to_do, &amp;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                   static_memory_size_gb,size_to_store_at_each_time_step,disk_size_of_each_dumping)</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="comment">! restore the simulation type that we have temporarily erased</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  simulation_type = saved_simulation_type</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordflow">if</span> (undo_attenuation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">if</span> (print_info_to_screen) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      print *,<span class="stringliteral">&#39;*******************************************************************************&#39;</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      print *,<span class="stringliteral">&#39;Estimating optimal disk dumping interval for UNDO_ATTENUATION:&#39;</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      print *,<span class="stringliteral">&#39;*******************************************************************************&#39;</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      print *</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      print *,<span class="stringliteral">&#39;without undoing of attenuation you are using &#39;</span>,static_memory_size_gb,<span class="stringliteral">&#39; GB per core&#39;</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      print *,<span class="stringliteral">&#39;  i.e. &#39;</span>,sngl(100.d0 * static_memory_size_gb / memory_installed_per_core_in_gb),<span class="stringliteral">&#39;% of the installed memory&#39;</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      print *</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      print *,<span class="stringliteral">&#39;each time step to store in memory to undo attenuation will require storing &#39;</span>, &amp;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    size_to_store_at_each_time_step,<span class="stringliteral">&#39; GB per core&#39;</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      print *</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      print *,<span class="stringliteral">&#39;*******************************************************************************&#39;</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      print *,<span class="stringliteral">&#39;the optimal value is thus NT_DUMP_ATTENUATION = &#39;</span>,nt_dump_attenuation_optimal</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      print *,<span class="stringliteral">&#39;*******************************************************************************&#39;</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      print *</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      print *,<span class="stringliteral">&#39;we will need to save a total of &#39;</span>,number_of_dumpings_to_do,<span class="stringliteral">&#39; dumpings (restart files) to disk&#39;</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      print *</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      print *,<span class="stringliteral">&#39;each dumping on the disk to undo attenuation will require storing &#39;</span>,disk_size_of_each_dumping,<span class="stringliteral">&#39; GB per core&#39;</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      print *</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      print *,<span class="stringliteral">&#39;each dumping on the disk will require storing &#39;</span>,disk_size_of_each_dumping*nproctot,<span class="stringliteral">&#39; GB for all cores&#39;</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      print *</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      print *,<span class="stringliteral">&#39;ALL dumpings on the disk will require storing &#39;</span>,disk_size_of_each_dumping*number_of_dumpings_to_do,<span class="stringliteral">&#39; GB per core&#39;</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      print *</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      print *,<span class="stringliteral">&#39;*******************************************************************************&#39;</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      print *,<span class="stringliteral">&#39;ALL dumpings on the disk will require storing &#39;</span>, &amp;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                     disk_size_of_each_dumping*number_of_dumpings_to_do*nproctot,<span class="stringliteral">&#39; GB for all cores&#39;</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      print *,<span class="stringliteral">&#39;  i.e. &#39;</span>,disk_size_of_each_dumping*number_of_dumpings_to_do*nproctot/1000.d0,<span class="stringliteral">&#39; TB&#39;</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      print *,<span class="stringliteral">&#39;*******************************************************************************&#39;</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      print *</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="comment">! copy number of elements and points in an include file for the solver</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keyword">open</span>(unit=iout,file=<span class="stringliteral">&#39;OUTPUT_FILES/values_from_mesher.h&#39;</span>,status=<span class="stringliteral">&#39;unknown&#39;</span>,iostat=ier)</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordflow">if</span> (ier /= 0 ) stop <span class="stringliteral">&#39;Error opening OUTPUT_FILES/values_from_mesher.h&#39;</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! this is the parameter file for static compilation of the solver&#39;</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! mesh statistics:&#39;</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! ---------------&#39;</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! number of chunks = &#39;</span>,nchunks</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">! the central cube is counted 6 times, therefore remove 5 times</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">if</span> (include_central_cube) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! these statistics include the central cube&#39;</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    subtract_central_cube_elems = 5.d0 * dble((nex_xi/8))**3</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    subtract_central_cube_points = 5.d0 * (dble(nex_xi/8)*dble(ngllx-1)+1.d0)**3</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! these statistics do not include the central cube&#39;</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    subtract_central_cube_elems = 0.d0</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    subtract_central_cube_points = 0.d0</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! number of processors = &#39;</span>,nproctot <span class="comment">! should be = NPROC</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! maximum number of points per region = &#39;</span>,nglob(iregion_crust_mantle)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">! use fused loops on NEC SX</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! on NEC SX, make sure &quot;loopcnt=&quot; parameter&#39;</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! in Makefile is greater than max vector length = &#39;</span>,nglob(iregion_crust_mantle)*ndim</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! total elements per slice = &#39;</span>,sum(nspec)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! total points per slice = &#39;</span>,sum(nglob)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! the time step of the solver will be DT = &#39;</span>,sngl(dt),<span class="stringliteral">&#39; (s)&#39;</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! the (approximate) minimum period resolved will be = &#39;</span>, &amp;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            sngl(max(angular_width_eta_in_degrees,angular_width_xi_in_degrees)/90.0 * 256.0/min(nex_eta,nex_xi) * 17.0),<span class="stringliteral">&#39; (s)&#39;</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="keyword">write</span>(iout,<span class="stringliteral">&#39;(1x,a,i1,a)&#39;</span>) <span class="stringliteral">&#39;! total for full &#39;</span>,nchunks,<span class="stringliteral">&#39;-chunk mesh:&#39;</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! ---------------------------&#39;</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! exact total number of spectral elements in entire mesh = &#39;</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! &#39;</span>,dble(nchunks)*dble(nproc)*dble(sum(nspec)) - subtract_central_cube_elems</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! approximate total number of points in entire mesh = &#39;</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! &#39;</span>,dble(nchunks)*dble(nproc)*dble(sum(nglob)) - subtract_central_cube_points</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">! there are 3 DOFs in solid regions, but only 1 in fluid outer core</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! approximate total number of degrees of freedom in entire mesh = &#39;</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! &#39;</span>,dble(nchunks)*dble(nproc)*(3.d0*(dble(sum(nglob))) &amp;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    - 2.d0*dble(nglob(iregion_outer_core))) &amp;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    - 3.d0*subtract_central_cube_points</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">! convert width to radians</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  angular_width_xi_rad = angular_width_xi_in_degrees * degrees_to_radians</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  angular_width_eta_rad = angular_width_eta_in_degrees * degrees_to_radians</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">! display location of chunk if regional run</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordflow">if</span> (nchunks /= 6) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! position of the mesh chunk at the surface:&#39;</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! -----------------------------------------&#39;</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! angular size in first direction in degrees = &#39;</span>,sngl(angular_width_xi_in_degrees)</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! angular size in second direction in degrees = &#39;</span>,sngl(angular_width_eta_in_degrees)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! longitude of center in degrees = &#39;</span>,sngl(center_longitude_in_degrees)</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! latitude of center in degrees = &#39;</span>,sngl(center_latitude_in_degrees)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! angle of rotation of the first chunk = &#39;</span>,sngl(gamma_rotation_azimuth)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">! compute rotation matrix from Euler angles</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keyword">call </span><a class="code" href="../../d9/ddf/euler__angles_8f90.html#a9060474b7d57a99380a608e120e99f73">euler_angles</a>(rotation_matrix,center_longitude_in_degrees,center_latitude_in_degrees,gamma_rotation_azimuth)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">! loop on the four corners of the chunk to display their coordinates</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    icorner = 0</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">do</span> iy = 0,1</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <span class="keywordflow">do</span> ix = 0,1</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      icorner = icorner + 1</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      xi= - angular_width_xi_rad/2. + dble(ix)*angular_width_xi_rad</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      eta= - angular_width_eta_rad/2. + dble(iy)*angular_width_eta_rad</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      x=dtan(xi)</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      y=dtan(eta)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      gamma=one/dsqrt(one+x*x+y*y)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      rgt=r_unit_sphere*gamma</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="comment">! define the mesh points at the top surface</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      x_top=-y*rgt</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      y_top=x*rgt</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      z_top=rgt</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      <span class="comment">! rotate top</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      vector_ori(1) = x_top</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      vector_ori(2) = y_top</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      vector_ori(3) = z_top</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="keywordflow">do</span> i=1,3</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        vector_rotated(i)=0.0d0</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="keywordflow">do</span> j=1,3</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          vector_rotated(i)=vector_rotated(i)+rotation_matrix(i,j)*vector_ori(j)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      x_top = vector_rotated(1)</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      y_top = vector_rotated(2)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      z_top = vector_rotated(3)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="comment">! convert to latitude and longitude</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keyword">call </span><a class="code" href="../../d9/df1/rthetaphi__xyz_8f90.html#a9a2d6558f7f1b34dfd37aa834f59ec97">xyz_2_rthetaphi_dble</a>(x_top,y_top,z_top,r_corner,theta_corner,phi_corner)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <span class="keyword">call </span><a class="code" href="../../d9/d27/reduce_8f90.html#a9759e908a22dc5603fa4394a09fc996b">reduce</a>(theta_corner,phi_corner)</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="comment">! convert geocentric to geographic colatitude</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="keyword">call </span><a class="code" href="../../d9/df1/rthetaphi__xyz_8f90.html#a606ed866ba0717c1a16bfe88714bc93c">geocentric_2_geographic_dble</a>(theta_corner,colat_corner)</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <span class="keywordflow">if</span> (phi_corner &gt; pi) phi_corner=phi_corner-two_pi</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      <span class="comment">! compute real position of the source</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      lat = (pi_over_two-colat_corner)*radians_to_degrees</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      long = phi_corner*radians_to_degrees</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! corner &#39;</span>,icorner</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! longitude in degrees = &#39;</span>,long</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! latitude in degrees = &#39;</span>,lat</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="keywordflow">  endif</span>  <span class="comment">! regional chunk</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="comment">! mesh averages</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordflow">if</span> (nchunks /= 6) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="comment">! regional mesh, variable chunk sizes</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    num_elem_gc = int( 90.d0 / angular_width_xi_in_degrees * 4 * nex_xi )</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    num_gll_gc = int( 90.d0 / angular_width_xi_in_degrees * 4 * nex_xi *(ngllx-1) )</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    avg_dist_deg = max( angular_width_xi_in_degrees/nex_xi,angular_width_eta_in_degrees/nex_eta ) / dble(ngllx-1)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    avg_dist_km = max( angular_width_xi_rad/nex_xi,angular_width_eta_rad/nex_eta ) * r_earth_km / dble(ngllx-1)</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    avg_element_size = max( angular_width_xi_rad/nex_xi,angular_width_eta_rad/nex_eta ) * r_earth_km</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="comment">! global mesh, chunks of 90 degrees</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    num_elem_gc = 4 * nex_xi</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    num_gll_gc = 4*nex_xi*(ngllx-1)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    avg_dist_deg = 360.d0 / dble(4) / dble(nex_xi*(ngllx-1))</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    avg_dist_km = two_pi / dble(4) * r_earth_km / dble(nex_xi*(ngllx-1))</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    avg_element_size = two_pi / dble(4) * r_earth_km / dble(nex_xi)</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! resolution of the mesh at the surface:&#39;</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! -------------------------------------&#39;</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! spectral elements along a great circle = &#39;</span>,num_elem_gc</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! GLL points along a great circle = &#39;</span>,num_gll_gc</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! average distance between points in degrees = &#39;</span>,<span class="keywordtype">real</span>(avg_dist_deg)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! average distance between points in km = &#39;</span>,<span class="keywordtype">real</span>(avg_dist_km)</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! average size of a spectral element in km = &#39;</span>,<span class="keywordtype">real</span>(avg_element_size)</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! approximate static memory needed by the solver:&#39;</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! ----------------------------------------------&#39;</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! (lower bound, usually the real amount used is 5% to 10% higher)&#39;</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! (you can get a more precise estimate of the size used per MPI process&#39;</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!  by typing &quot;size -d bin/xspecfem3D&quot;&#39;</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!  after compiling the code with the DATA/Par_file you plan to use)&#39;</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! size of static arrays per slice = &#39;</span>,static_memory_size/1.d6,<span class="stringliteral">&#39; MB&#39;</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!                                 = &#39;</span>,static_memory_size/1048576.d0,<span class="stringliteral">&#39; MiB&#39;</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!                                 = &#39;</span>,static_memory_size/1.d9,<span class="stringliteral">&#39; GB&#39;</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!                                 = &#39;</span>,static_memory_size/1073741824.d0,<span class="stringliteral">&#39; GiB&#39;</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">! note: using less memory becomes an issue only if the strong scaling of the code is poor.</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">!          Some users will run simulations with an executable using far less than 80% RAM per core</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">!          if they prefer having a faster computational time (and use a higher number of cores).</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! (should be below to 80% or 90% of the memory installed per core)&#39;</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! (if significantly more, the job will not run by lack of memory )&#39;</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! (note that if significantly less, you waste a significant amount&#39;</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!  of memory per processor core)&#39;</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! (but that can be perfectly acceptable if you can afford it and&#39;</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!  want faster results by using more cores)&#39;</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordflow">if</span> (static_memory_size*dble(nproctot)/1.d6 &lt; 10000.d0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! size of static arrays for all slices = &#39;</span>,static_memory_size*dble(nproctot)/1.d6,<span class="stringliteral">&#39; MB&#39;</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!                                      = &#39;</span>,static_memory_size*dble(nproctot)/1048576.d0,<span class="stringliteral">&#39; MiB&#39;</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!                                      = &#39;</span>,static_memory_size*dble(nproctot)/1.d9,<span class="stringliteral">&#39; GB&#39;</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;! size of static arrays for all slices = &#39;</span>,static_memory_size*dble(nproctot)/1.d9,<span class="stringliteral">&#39; GB&#39;</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!                                      = &#39;</span>,static_memory_size*dble(nproctot)/1073741824.d0,<span class="stringliteral">&#39; GiB&#39;</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!                                      = &#39;</span>,static_memory_size*dble(nproctot)/1.d12,<span class="stringliteral">&#39; TB&#39;</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!                                      = &#39;</span>,static_memory_size*dble(nproctot)/1099511627776.d0,<span class="stringliteral">&#39; TiB&#39;</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;!&#39;</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NEX_XI_VAL = &#39;</span>,nex_xi</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NEX_ETA_VAL = &#39;</span>,nex_eta</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_CRUST_MANTLE = &#39;</span>,nspec(iregion_crust_mantle)</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_OUTER_CORE = &#39;</span>,nspec(iregion_outer_core)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_INNER_CORE = &#39;</span>,nspec(iregion_inner_core)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NGLOB_CRUST_MANTLE = &#39;</span>,nglob(iregion_crust_mantle)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NGLOB_OUTER_CORE = &#39;</span>,nglob(iregion_outer_core)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NGLOB_INNER_CORE = &#39;</span>,nglob(iregion_inner_core)</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPECMAX_ANISO_IC = &#39;</span>,nspecmax_aniso_ic</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPECMAX_ISO_MANTLE = &#39;</span>,nspecmax_iso_mantle</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPECMAX_TISO_MANTLE = &#39;</span>,nspecmax_tiso_mantle</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPECMAX_ANISO_MANTLE = &#39;</span>,nspecmax_aniso_mantle</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_CRUST_MANTLE_ATTENUATION = &#39;</span>,nspec_crust_mantle_attenuation</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_INNER_CORE_ATTENUATION = &#39;</span>,nspec_inner_core_attenuation</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_CRUST_MANTLE_STR_OR_ATT = &#39;</span>,nspec_crust_mantle_str_or_att</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_INNER_CORE_STR_OR_ATT = &#39;</span>,nspec_inner_core_str_or_att</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_CRUST_MANTLE_STR_AND_ATT = &#39;</span>,nspec_crust_mantle_str_and_att</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_INNER_CORE_STR_AND_ATT = &#39;</span>,nspec_inner_core_str_and_att</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_CRUST_MANTLE_STRAIN_ONLY = &#39;</span>,nspec_crust_mantle_strain_only</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_INNER_CORE_STRAIN_ONLY = &#39;</span>,nspec_inner_core_strain_only</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_CRUST_MANTLE_ADJOINT = &#39;</span>,nspec_crust_mantle_adjoint</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_OUTER_CORE_ADJOINT = &#39;</span>,nspec_outer_core_adjoint</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_INNER_CORE_ADJOINT = &#39;</span>,nspec_inner_core_adjoint</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <span class="comment">! unused... (dynamic allocation used)</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="comment">!if (ANISOTROPIC_KL) then</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="comment">!  write(IOUT,*) &#39;integer, parameter :: NSPEC_CRUST_MANTLE_ADJOINT_ANISO_KL = &#39;,NSPEC_CRUST_MANTLE_ADJOINT</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="comment">!else</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="comment">!  write(IOUT,*) &#39;integer, parameter :: NSPEC_CRUST_MANTLE_ADJOINT_ANISO_KL = &#39;,1</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  <span class="comment">!endif</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="comment">! unused... (dynamic allocation used)</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  <span class="comment">!if (APPROXIMATE_HESS_KL) then</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="comment">!  write(IOUT,*) &#39;integer, parameter :: NSPEC_CRUST_MANTLE_ADJOINT_HESS = &#39;,NSPEC_CRUST_MANTLE_ADJOINT</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <span class="comment">!else</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="comment">!  write(IOUT,*) &#39;integer, parameter :: NSPEC_CRUST_MANTLE_ADJOINT_HESS = &#39;,1</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="comment">!endif</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <span class="comment">! unused... (dynamic allocation used)</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="comment">!if (NOISE_TOMOGRAPHY &gt; 0) then</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">!  write(IOUT,*) &#39;integer, parameter :: NSPEC_CRUST_MANTLE_ADJOINT_NOISE = &#39;,NSPEC_CRUST_MANTLE_ADJOINT</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">!else</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">!  write(IOUT,*) &#39;integer, parameter :: NSPEC_CRUST_MANTLE_ADJOINT_NOISE = &#39;,1</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="comment">!endif</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NGLOB_CRUST_MANTLE_ADJOINT = &#39;</span>,nglob_crust_mantle_adjoint</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NGLOB_OUTER_CORE_ADJOINT = &#39;</span>,nglob_outer_core_adjoint</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NGLOB_INNER_CORE_ADJOINT = &#39;</span>,nglob_inner_core_adjoint</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_OUTER_CORE_ROT_ADJOINT = &#39;</span>,nspec_outer_core_rot_adjoint</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_CRUST_MANTLE_STACEY = &#39;</span>,nspec_crust_mantle_stacey</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_OUTER_CORE_STACEY = &#39;</span>,nspec_outer_core_stacey</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NGLOB_CRUST_MANTLE_OCEANS = &#39;</span>,nglob_crust_mantle_oceans</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">! this to allow for code elimination by the compiler in the solver for performance</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="keywordflow">if</span> (transverse_isotropy) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: TRANSVERSE_ISOTROPY_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: TRANSVERSE_ISOTROPY_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keywordflow">if</span> (anisotropic_3d_mantle) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ANISOTROPIC_3D_MANTLE_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ANISOTROPIC_3D_MANTLE_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;  <span class="keywordflow">if</span> (anisotropic_inner_core) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ANISOTROPIC_INNER_CORE_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ANISOTROPIC_INNER_CORE_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="keywordflow">if</span> (attenuation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ATTENUATION_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ATTENUATION_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordflow">if</span> (attenuation_3d) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ATTENUATION_3D_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ATTENUATION_3D_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordflow">if</span> (ellipticity) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ELLIPTICITY_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ELLIPTICITY_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keywordflow">if</span> (gravity) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: GRAVITY_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: GRAVITY_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <span class="keywordflow">if</span> (oceans) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: OCEANS_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: OCEANS_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="keywordflow">if</span> (topography .or. oceans) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NX_BATHY_VAL = &#39;</span>,nx_bathy</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NY_BATHY_VAL = &#39;</span>,ny_bathy</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NX_BATHY_VAL = 1&#39;</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NY_BATHY_VAL = 1&#39;</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="keywordflow">if</span> (rotation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ROTATION_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ROTATION_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="keywordflow">if</span> (exact_mass_matrix_for_rotation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: EXACT_MASS_MATRIX_FOR_ROTATION_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: EXACT_MASS_MATRIX_FOR_ROTATION_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_OUTER_CORE_ROTATION = &#39;</span>,nspec_outer_core_rotation</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="keywordflow">if</span> (partial_phys_dispersion_only) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: PARTIAL_PHYS_DISPERSION_ONLY_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: PARTIAL_PHYS_DISPERSION_ONLY_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NPROC_XI_VAL = &#39;</span>,nproc_xi</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NPROC_ETA_VAL = &#39;</span>,nproc_eta</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NCHUNKS_VAL = &#39;</span>,nchunks</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NPROCTOT_VAL = &#39;</span>,nproctot</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: ATT1_VAL = &#39;</span>,att1</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: ATT2_VAL = &#39;</span>,att2</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: ATT3_VAL = &#39;</span>,att3</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: ATT4_VAL = &#39;</span>,att4</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: ATT5_VAL = &#39;</span>,att5</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2DMAX_XMIN_XMAX_CM = &#39;</span>,nspec2dmax_xmin_xmax(iregion_crust_mantle)</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2DMAX_YMIN_YMAX_CM = &#39;</span>,nspec2dmax_ymin_ymax(iregion_crust_mantle)</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2D_BOTTOM_CM = &#39;</span>,nspec2d_bottom(iregion_crust_mantle)</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2D_TOP_CM = &#39;</span>,nspec2d_top(iregion_crust_mantle)</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2DMAX_XMIN_XMAX_IC = &#39;</span>,nspec2dmax_xmin_xmax(iregion_inner_core)</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2DMAX_YMIN_YMAX_IC = &#39;</span>,nspec2dmax_ymin_ymax(iregion_inner_core)</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2D_BOTTOM_IC = &#39;</span>,nspec2d_bottom(iregion_inner_core)</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2D_TOP_IC = &#39;</span>,nspec2d_top(iregion_inner_core)</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2DMAX_XMIN_XMAX_OC = &#39;</span>,nspec2dmax_xmin_xmax(iregion_outer_core)</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2DMAX_YMIN_YMAX_OC = &#39;</span>,nspec2dmax_ymin_ymax(iregion_outer_core)</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2D_BOTTOM_OC = &#39;</span>,nspec2d_bottom(iregion_outer_core)</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2D_TOP_OC = &#39;</span>,nspec2d_top(iregion_outer_core)</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="comment">! for boundary kernels</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <span class="keywordflow">if</span> (save_boundary_mesh) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    nspec2d_moho = nspec2d_top(iregion_crust_mantle)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    nspec2d_400 = nspec2d_moho / 4</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    nspec2d_670 = nspec2d_400</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    nspec2d_cmb = nspec2d_bottom(iregion_crust_mantle)</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    nspec2d_icb = nspec2d_bottom(iregion_outer_core)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    nspec2d_moho = 1</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    nspec2d_400 = 1</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    nspec2d_670 = 1</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    nspec2d_cmb = 1</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    nspec2d_icb = 1</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2D_MOHO = &#39;</span>,nspec2d_moho</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2D_400 = &#39;</span>,nspec2d_400</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2D_670 = &#39;</span>,nspec2d_670</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2D_CMB = &#39;</span>,nspec2d_cmb</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC2D_ICB = &#39;</span>,nspec2d_icb</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="comment">! Deville routines only implemented for NGLLX = NGLLY = NGLLZ = 5</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordflow">if</span> (ngllx == 5 .and. nglly == 5 .and. ngllz == 5) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: USE_DEVILLE_PRODUCTS_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: USE_DEVILLE_PRODUCTS_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keywordflow">if</span> (movie_volume) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_CRUST_MANTLE_3DMOVIE = NSPEC_CRUST_MANTLE&#39;</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NGLOB_CRUST_MANTLE_3DMOVIE = NGLOB_CRUST_MANTLE&#39;</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_CRUST_MANTLE_3DMOVIE = 1&#39;</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NGLOB_CRUST_MANTLE_3DMOVIE = 1&#39;</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keywordflow">if</span> (movie_volume .and. movie_volume_type == 4) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_OUTER_CORE_3DMOVIE = NSPEC_OUTER_CORE&#39;</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NSPEC_OUTER_CORE_3DMOVIE = 1&#39;</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="keywordflow">if</span> (save_regular_kl) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NM_KL_REG_PTS_VAL = NM_KL_REG_PTS&#39;</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NM_KL_REG_PTS_VAL = 1&#39;</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="comment">! in the case of Stacey boundary conditions, add C*delta/2 contribution to the mass matrix</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="comment">! on the Stacey edges for the crust_mantle and outer_core regions but not for the inner_core region</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="comment">! thus the mass matrix must be replaced by three mass matrices including the &quot;C&quot; damping matrix</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="comment">!</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="comment">! if absorbing_conditions are not set or if NCHUNKS=6, only one mass matrix is needed</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="comment">! for the sake of performance, only &quot;rmassz&quot; array will be filled and &quot;rmassx&quot; &amp; &quot;rmassy&quot; will be fictitious / unused</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keywordflow">if</span> (nchunks /= 6 .and. absorbing_conditions) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;     nglob_xy_cm = nglob(iregion_crust_mantle)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;     nglob_xy_cm = 1</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  nglob_xy_ic = 1</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="keywordflow">if</span> (rotation .and. exact_mass_matrix_for_rotation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    nglob_xy_cm = nglob(iregion_crust_mantle)</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    nglob_xy_ic = nglob(iregion_inner_core)</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NGLOB_XY_CM = &#39;</span>,nglob_xy_cm</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NGLOB_XY_IC = &#39;</span>,nglob_xy_ic</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keywordflow">if</span> (attenuation_1d_with_3d_storage) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ATTENUATION_1D_WITH_3D_STORAGE_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: ATTENUATION_1D_WITH_3D_STORAGE_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="comment">! we use this vectorization flag for solver routines in files **.f90</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="preprocessor">#ifdef FORCE_VECTORIZATION</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="preprocessor"></span>  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: FORCE_VECTORIZATION_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="preprocessor"></span>  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: FORCE_VECTORIZATION_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="preprocessor"></span>  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="comment">! for UNDO_ATTENUATION</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordflow">if</span> (undo_attenuation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: UNDO_ATTENUATION_VAL = .true.&#39;</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;logical, parameter :: UNDO_ATTENUATION_VAL = .false.&#39;</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keyword">write</span>(iout,*) <span class="stringliteral">&#39;integer, parameter :: NT_DUMP_ATTENUATION_VAL = &#39;</span>,nt_dump_attenuation_optimal</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="comment">! mesh geometry (with format specifier to avoid writing double values on a newline)</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keyword">write</span>(iout,<span class="stringliteral">&#39;(1x,a,f12.6)&#39;</span>) <span class="stringliteral">&#39;double precision, parameter :: ANGULAR_WIDTH_ETA_IN_DEGREES_VAL = &#39;</span>,angular_width_eta_in_degrees</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="keyword">write</span>(iout,<span class="stringliteral">&#39;(1x,a,f12.6)&#39;</span>) <span class="stringliteral">&#39;double precision, parameter :: ANGULAR_WIDTH_XI_IN_DEGREES_VAL = &#39;</span>,angular_width_xi_in_degrees</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keyword">write</span>(iout,<span class="stringliteral">&#39;(1x,a,f12.6)&#39;</span>) <span class="stringliteral">&#39;double precision, parameter :: CENTER_LATITUDE_IN_DEGREES_VAL = &#39;</span>,center_latitude_in_degrees</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="keyword">write</span>(iout,<span class="stringliteral">&#39;(1x,a,f12.6)&#39;</span>) <span class="stringliteral">&#39;double precision, parameter :: CENTER_LONGITUDE_IN_DEGREES_VAL = &#39;</span>,center_longitude_in_degrees</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  <span class="keyword">write</span>(iout,<span class="stringliteral">&#39;(1x,a,f12.6)&#39;</span>) <span class="stringliteral">&#39;double precision, parameter :: GAMMA_ROTATION_AZIMUTH_VAL = &#39;</span>,gamma_rotation_azimuth</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keyword">write</span>(iout,*)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keyword">close</span>(iout)</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="keyword">  end subroutine </span><a class="code" href="../../df/dde/save__header__file_8_f90.html#a4363853726f81e0cf4c3d52760b73b00">save_header_file</a></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment">!-------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment">! compute the optimal interval at which to dump restart files to disk to undo attenuation in an exact way</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment">! Dimitri Komatitsch and Zhinan Xie, CNRS Marseille, France, June 2013.</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="keyword">  subroutine </span><a class="code" href="../../df/dde/save__header__file_8_f90.html#a082f59ac5e4681ee2fb74b9f60765482">compute_optimized_dumping</a>(static_memory_size,NT_DUMP_ATTENUATION_optimal,number_of_dumpings_to_do, &amp;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                                       static_memory_size_gb,size_to_store_at_each_time_step,disk_size_of_each_dumping)</div>
<div class="line"><a name="l00819"></a><span class="lineno"><a class="line" href="../../df/dde/save__header__file_8_f90.html#a082f59ac5e4681ee2fb74b9f60765482">  819</a></span>&#160;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keywordtype">use </span><a class="code" href="../../d5/d7b/namespaceshared__parameters.html">shared_parameters</a><span class="keywordtype">, only</span>: nglob,nspec,nstep, &amp;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    rotation,attenuation,gpu_mode, &amp;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    memory_installed_per_core_in_gb,percent_of_mem_to_use_per_core,noise_tomography, &amp;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    nspec2d_top</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="keywordtype">use </span><a class="code" href="../../d7/d28/namespaceconstants.html">constants</a><span class="keywordtype">, only</span>: ngllx,nglly,ngllz,ndim,n_sls,custom_real, &amp;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    iregion_crust_mantle,iregion_inner_core,iregion_outer_core</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="keywordtype">double precision</span>, <span class="keywordtype">intent(in)</span> :: static_memory_size</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: NT_DUMP_ATTENUATION_optimal,number_of_dumpings_to_do</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="keywordtype">double precision</span>, <span class="keywordtype">intent(out)</span> :: static_memory_size_GB,size_to_store_at_each_time_step,disk_size_of_each_dumping</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordtype">double precision</span> :: what_we_can_use_in_GB</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordflow">if</span> (memory_installed_per_core_in_gb &lt; 0.1d0) &amp;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;       stop <span class="stringliteral">&#39;less than 100 MB per core for MEMORY_INSTALLED_PER_CORE_IN_GB does not seem realistic; exiting...&#39;</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">!! DK DK the value below will probably need to be increased one day, on future machines</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="keywordflow">if</span> (memory_installed_per_core_in_gb &gt; 512.d0) &amp;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;       stop <span class="stringliteral">&#39;more than 512 GB per core for MEMORY_INSTALLED_PER_CORE_IN_GB does not seem realistic; exiting...&#39;</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="keywordflow">if</span> (percent_of_mem_to_use_per_core &lt; 50.d0) &amp;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;       stop <span class="stringliteral">&#39;less than 50% for PERCENT_OF_MEM_TO_USE_PER_CORE does not seem realistic; exiting...&#39;</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordflow">if</span> (percent_of_mem_to_use_per_core &gt; 100.d0) &amp;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;       stop <span class="stringliteral">&#39;more than 100% for PERCENT_OF_MEM_TO_USE_PER_CORE makes no sense; exiting...&#39;</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">!! DK DK will need to remove the .and. .not. GPU_MODE test here</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">!! DK DK if the undo_attenuation buffers are stored on the GPU instead of on the host</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keywordflow">if</span> (percent_of_mem_to_use_per_core &gt; 92.d0 .and. .not. gpu_mode) &amp;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;       stop <span class="stringliteral">&#39;more than 92% for PERCENT_OF_MEM_TO_USE_PER_CORE when not using GPUs is risky; exiting...&#39;</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  what_we_can_use_in_gb = memory_installed_per_core_in_gb * percent_of_mem_to_use_per_core / 100.d0</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">! convert static memory size to GB</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  static_memory_size_gb = static_memory_size / 1.d9</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">!! DK DK June 2014: TODO  this comment is true but the statement is commented out for now</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">!! DK DK June 2014: TODO  because there is no GPU support for UNDO_ATTENUATION yet</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">!! DK DK June 2014:</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">! in the case of GPUs, the buffers remain on the host i.e. on the CPU, thus static_memory_size_GB could be set to zero here</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment">! because the solver uses almost no permanent host memory, since all calculations are performed and stored on the device;</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">! however we prefer not to do that here because we probably have some temporary copies of all the arrays created on the host first,</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">! and it is not clear if they are then suppressed when the time loop of the solver starts because static memory allocation</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">! is used for big arrays on the host rather than dynamic, thus there is no way of freeing it dynamically.</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">! Thus for now we prefer not to set static_memory_size_GB to zero here.</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">!</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment">! if (GPU_MODE) static_memory_size_GB = 0.d0</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordflow">if</span> (static_memory_size_gb &gt;= memory_installed_per_core_in_gb) &amp;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    stop <span class="stringliteral">&#39;you are using more memory than what you told us is installed!!! there is an error&#39;</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="keywordflow">if</span> (static_memory_size_gb &gt;= what_we_can_use_in_gb) &amp;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    stop <span class="stringliteral">&#39;you are using more memory than what you allowed us to use!!! there is an error&#39;</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">! compute the size to store in memory at each time step</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  size_to_store_at_each_time_step = 0</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">! displ_crust_mantle</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  size_to_store_at_each_time_step = size_to_store_at_each_time_step + dble(ndim)*nglob(iregion_crust_mantle)*dble(custom_real)</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">! displ_inner_core</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  size_to_store_at_each_time_step = size_to_store_at_each_time_step + dble(ndim)*nglob(iregion_inner_core)*dble(custom_real)</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment">! displ_outer_core and accel_outer_core (both being scalar arrays)</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  size_to_store_at_each_time_step = size_to_store_at_each_time_step + 2.d0*nglob(iregion_outer_core)*dble(custom_real)</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">! noise_surface_movie</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="keywordflow">if</span> (noise_tomography == 3) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    size_to_store_at_each_time_step = size_to_store_at_each_time_step &amp;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      + dble(ndim)*dble(ngllx*nglly)*dble(nspec2d_top(iregion_crust_mantle))*dble(custom_real)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">! convert to GB</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  size_to_store_at_each_time_step = size_to_store_at_each_time_step / 1.d9</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  nt_dump_attenuation_optimal = int((what_we_can_use_in_gb - static_memory_size_gb) / size_to_store_at_each_time_step)</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">! compute the size of files to dump to disk</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  disk_size_of_each_dumping = 0</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">! displ_crust_mantle, veloc_crust_mantle, accel_crust_mantle</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  disk_size_of_each_dumping = disk_size_of_each_dumping + 3.d0*dble(ndim)*nglob(iregion_crust_mantle)*dble(custom_real)</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">! displ_inner_core, veloc_inner_core, accel_inner_core</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  disk_size_of_each_dumping = disk_size_of_each_dumping + 3.d0*dble(ndim)*nglob(iregion_inner_core)*dble(custom_real)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">! displ_outer_core, veloc_outer_core, accel_outer_core (all scalar arrays)</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  disk_size_of_each_dumping = disk_size_of_each_dumping + 3.d0*nglob(iregion_outer_core)*dble(custom_real)</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">! A_array_rotation,B_array_rotation</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="keywordflow">if</span> (rotation) disk_size_of_each_dumping = disk_size_of_each_dumping + &amp;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      dble(ngllx)*dble(nglly)*dble(ngllz)*nspec(iregion_outer_core)*2.d0*dble(custom_real)</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordflow">if</span> (attenuation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">! R_memory_crust_mantle</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    disk_size_of_each_dumping = disk_size_of_each_dumping + 5.d0*dble(n_sls)*dble(ngllx)* &amp;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      dble(nglly)*dble(ngllz)*nspec(iregion_crust_mantle)*dble(custom_real)</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">! R_memory_inner_core</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    disk_size_of_each_dumping = disk_size_of_each_dumping + 5.d0*dble(n_sls)*dble(ngllx)* &amp;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      dble(nglly)*dble(ngllz)*nspec(iregion_inner_core)*dble(custom_real)</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">! convert to GB</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  disk_size_of_each_dumping = disk_size_of_each_dumping / 1.d9</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">!! DK DK this formula could be made more precise; currently in some cases it can probably be off by +1 or -1; does not matter much</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  number_of_dumpings_to_do = ceiling( dble(nstep)/dble(nt_dump_attenuation_optimal) )</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="keyword">  end subroutine </span><a class="code" href="../../df/dde/save__header__file_8_f90.html#a082f59ac5e4681ee2fb74b9f60765482">compute_optimized_dumping</a></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;</div>
<div class="ttc" id="euler__angles_8f90_html_a9060474b7d57a99380a608e120e99f73"><div class="ttname"><a href="../../d9/ddf/euler__angles_8f90.html#a9060474b7d57a99380a608e120e99f73">euler_angles</a></div><div class="ttdeci">subroutine euler_angles(rotation_matrix, CENTER_LONGITUDE_IN_DEGREES, CENTER_LATITUDE_IN_DEGREES, GAMMA_ROTATION_AZIMUTH)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/ddf/euler__angles_8f90_source.html#l00031">euler_angles.f90:31</a></div></div>
<div class="ttc" id="namespaceconstants_html"><div class="ttname"><a href="../../d7/d28/namespaceconstants.html">constants</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6e/shared__par_8f90_source.html#l00028">shared_par.f90:28</a></div></div>
<div class="ttc" id="save__header__file_8_f90_html_a082f59ac5e4681ee2fb74b9f60765482"><div class="ttname"><a href="../../df/dde/save__header__file_8_f90.html#a082f59ac5e4681ee2fb74b9f60765482">compute_optimized_dumping</a></div><div class="ttdeci">subroutine compute_optimized_dumping(static_memory_size, NT_DUMP_ATTENUATION_optimal, number_of_dumpings_to_do,                                                                                                                                                       static_memory_size_GB, size_to_store_at_each_time_step, disk_size_of_each_dumping)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dde/save__header__file_8_f90_source.html#l00819">save_header_file.F90:819</a></div></div>
<div class="ttc" id="rthetaphi__xyz_8f90_html_a606ed866ba0717c1a16bfe88714bc93c"><div class="ttname"><a href="../../d9/df1/rthetaphi__xyz_8f90.html#a606ed866ba0717c1a16bfe88714bc93c">geocentric_2_geographic_dble</a></div><div class="ttdeci">subroutine geocentric_2_geographic_dble(theta, theta_prime)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df1/rthetaphi__xyz_8f90_source.html#l00149">rthetaphi_xyz.f90:149</a></div></div>
<div class="ttc" id="reduce_8f90_html_a9759e908a22dc5603fa4394a09fc996b"><div class="ttname"><a href="../../d9/d27/reduce_8f90.html#a9759e908a22dc5603fa4394a09fc996b">reduce</a></div><div class="ttdeci">subroutine reduce(theta, phi)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d27/reduce_8f90_source.html#l00029">reduce.f90:29</a></div></div>
<div class="ttc" id="memory__eval_8f90_html_a8e678cc09ae49efba061153da060fb20"><div class="ttname"><a href="../../d2/d2a/memory__eval_8f90.html#a8e678cc09ae49efba061153da060fb20">memory_eval</a></div><div class="ttdeci">subroutine memory_eval(doubling_index, this_region_has_a_doubling,                                                                                               ner, NEX_PER_PROC_XI, NEX_PER_PROC_ETA,                                                                                               ratio_sampling_array, NPROCTOT,                                                                                               NSPEC, NGLOB,                                                                                               NSPECMAX_ANISO_IC, NSPECMAX_ISO_MANTLE, NSPECMAX_TISO_MANTLE,                                                                                               NSPECMAX_ANISO_MANTLE, NSPEC_CRUST_MANTLE_ATTENUATION,                                                                                               NSPEC_INNER_CORE_ATTENUATION,                                                                                               NSPEC_CRUST_MANTLE_STR_OR_ATT, NSPEC_INNER_CORE_STR_OR_ATT,                                                                                               NSPEC_CRUST_MANTLE_STR_AND_ATT, NSPEC_INNER_CORE_STR_AND_ATT,                                                                                               NSPEC_CRUST_MANTLE_STRAIN_ONLY, NSPEC_INNER_CORE_STRAIN_ONLY,                                                                                               NSPEC_CRUST_MANTLE_ADJOINT,                                                                                               NSPEC_OUTER_CORE_ADJOINT, NSPEC_INNER_CORE_ADJOINT,                                                                                               NGLOB_CRUST_MANTLE_ADJOINT, NGLOB_OUTER_CORE_ADJOINT,                                                                                               NGLOB_INNER_CORE_ADJOINT, NSPEC_OUTER_CORE_ROT_ADJOINT,                                                                                               NSPEC_CRUST_MANTLE_STACEY, NSPEC_OUTER_CORE_STACEY,                                                                                               NGLOB_CRUST_MANTLE_OCEANS, NSPEC_OUTER_CORE_ROTATION,                                                                                               NSPEC2D_BOTTOM, NSPEC2D_TOP,                                                                                               static_memory_size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d2a/memory__eval_8f90_source.html#l00048">memory_eval.f90:48</a></div></div>
<div class="ttc" id="rthetaphi__xyz_8f90_html_a9a2d6558f7f1b34dfd37aa834f59ec97"><div class="ttname"><a href="../../d9/df1/rthetaphi__xyz_8f90.html#a9a2d6558f7f1b34dfd37aa834f59ec97">xyz_2_rthetaphi_dble</a></div><div class="ttdeci">subroutine xyz_2_rthetaphi_dble(x, y, z, r, theta, phi)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df1/rthetaphi__xyz_8f90_source.html#l00062">rthetaphi_xyz.f90:62</a></div></div>
<div class="ttc" id="namespaceshared__parameters_html"><div class="ttname"><a href="../../d5/d7b/namespaceshared__parameters.html">shared_parameters</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6e/shared__par_8f90_source.html#l00235">shared_par.f90:235</a></div></div>
<div class="ttc" id="save__header__file_8_f90_html_a4363853726f81e0cf4c3d52760b73b00"><div class="ttname"><a href="../../df/dde/save__header__file_8_f90.html#a4363853726f81e0cf4c3d52760b73b00">save_header_file</a></div><div class="ttdeci">subroutine save_header_file(NSPEC, NGLOB, NPROC, NPROCTOT,                                                                                                                   static_memory_size,                                                                                                                   NSPEC2D_TOP, NSPEC2D_BOTTOM,                                                                                                                   NSPEC2DMAX_YMIN_YMAX, NSPEC2DMAX_XMIN_XMAX,                                                                                                                   NSPECMAX_ANISO_IC, NSPECMAX_ISO_MANTLE, NSPECMAX_TISO_MANTLE,                                                                                                                   NSPECMAX_ANISO_MANTLE, NSPEC_CRUST_MANTLE_ATTENUATION,                                                                                                                   NSPEC_INNER_CORE_ATTENUATION,                                                                                                                   NSPEC_CRUST_MANTLE_STR_OR_ATT, NSPEC_INNER_CORE_STR_OR_ATT,                                                                                                                   NSPEC_CRUST_MANTLE_STR_AND_ATT, NSPEC_INNER_CORE_STR_AND_ATT,                                                                                                                   NSPEC_CRUST_MANTLE_STRAIN_ONLY, NSPEC_INNER_CORE_STRAIN_ONLY,                                                                                                                   NSPEC_CRUST_MANTLE_ADJOINT,                                                                                                                   NSPEC_OUTER_CORE_ADJOINT, NSPEC_INNER_CORE_ADJOINT,                                                                                                                   NGLOB_CRUST_MANTLE_ADJOINT, NGLOB_OUTER_CORE_ADJOINT,                                                                                                                   NGLOB_INNER_CORE_ADJOINT, NSPEC_OUTER_CORE_ROT_ADJOINT,                                                                                                                   NSPEC_CRUST_MANTLE_STACEY, NSPEC_OUTER_CORE_STACEY,                                                                                                                   NGLOB_CRUST_MANTLE_OCEANS, NSPEC_OUTER_CORE_ROTATION, NT_DUMP_ATTENUATION_optimal,                                                                                                                   PRINT_INFO_TO_SCREEN)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dde/save__header__file_8_f90_source.html#l00047">save_header_file.F90:47</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- custom-made footer -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_76fc807e71a78804243adb7d05973764.html">SPECFEM3D_GLOBE</a></li><li class="navelem"><a class="el" href="../../dir_3e3821fc19411950b1ac0b3a66489b15.html">src</a></li><li class="navelem"><a class="el" href="../../dir_3a9dd49d296ea2d45f2f60dc7939a1ee.html">shared</a></li><li class="navelem"><a class="el" href="../../df/dde/save__header__file_8_f90.html">save_header_file.F90</a></li> 
    <li class="footer">
    <!--
    Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.10
    -->   
    doxygen for <a href="https://github.com/geodynamics/specfem3d_globe">SPECFEM3D_GLOBE</a>
    </li>
  </ul>
</div>
</body>
</html>
