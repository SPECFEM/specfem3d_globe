#=====================================================================
#
#          S p e c f e m 3 D  G l o b e  V e r s i o n  5 . 1
#          --------------------------------------------------
#
#          Main authors: Dimitri Komatitsch and Jeroen Tromp
#                        Princeton University, USA
#             and University of Pau / CNRS / INRIA, France
# (c) Princeton University / California Institute of Technology and University of Pau / CNRS / INRIA
#                            April 2011
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
#
#=====================================================================

# @configure_input@

####
#### targets
####

# default targets
DEFAULT = \
	xmeshfem3D \
	xcreate_header_file \
	xspecfem3D \
	xcheck_buffers_1D \
	xcheck_buffers_2D \
	xcheck_buffers_corners_chunks \
	xcheck_buffers_faces_chunks \
	xcombine_AVS_DX \
	xconvolve_source_timefunction \
	xcreate_movie_AVS_DX \
	xcreate_movie_GMT_global \
	$(EMPTY_MACRO)

default: $(DEFAULT)

all: default

required: bin obj

@COND_ADIOS_TRUE@gen_adios_inc:
	(cd setup/adios_xml_files; gpp.py *.xml; mv *.fh ../../src/specfem3D)
@COND_ADIOS_FALSE@gen_adios_inc:

backup:
	cp -rp src setup DATA/Par_file* Makefile go_mesher* go_solver* mymachines bak

bak: backup

mesh : meshfem3D
spec : specfem3D

specfem3D: xspecfem3D
meshfem3D: xmeshfem3D

create_header_file: xcreate_header_file
combine_vol_data: xcombine_vol_data
combine_vol_data_vtk: xcombine_vol_data_vtk
combine_surf_data: xcombine_surf_data
convolve_source_timefunction: xconvolve_source_timefunction
create_movie_AVS_DX: xcreate_movie_AVS_DX
create_movie_GMT_global: xcreate_movie_GMT_global

bin:
	mkdir -p bin

obj:
	mkdir -p obj


xmeshfem3D:  required
	     (cd src/meshfem3D; make)

xspecfem3D:  required gen_adios_inc
	     (cd src/specfem3D; make)

xcreate_header_file:  required
	     (cd src/create_header_file; make)

xcheck_buffers_1D: required
	(cd src/auxiliaries ; make xcheck_buffers_1D)

xcheck_buffers_2D: required
	(cd src/auxiliaries ; make xcheck_buffers_2D)

xcheck_buffers_corners_chunks: required
	(cd src/auxiliaries ; make xcheck_buffers_corners_chunks)

xcheck_buffers_faces_chunks: required
	(cd src/auxiliaries ; make xcheck_buffers_faces_chunks)

xcombine_AVS_DX: required
	(cd src/auxiliaries ; make xcombine_AVS_DX)

xcombine_vol_data: required
	(cd src/auxiliaries ; make xcombine_vol_data)

xcombine_vol_data_vtk: required
	(cd src/auxiliaries ; make xcombine_vol_data_vtk)

xcombine_surf_data: required
	(cd src/auxiliaries ; make xcombine_surf_data)

xconvolve_source_timefunction: required
	(cd src/auxiliaries ; make xconvolve_source_timefunction)

xcreate_movie_AVS_DX: required
	(cd src/auxiliaries ; make xcreate_movie_AVS_DX)

xcreate_movie_GMT_global: required
	(cd src/auxiliaries ; make xcreate_movie_GMT_global)


clean: required
	(rm -rf bin lib obj )
	(cd src/meshfem3D; make clean)
	(cd src/specfem3D; make clean)
	(cd src/create_header_file; make clean)
	(cd src/auxiliaries; make clean)
	(rm -rf src/meshfem3D/*.mod src/specfem3D/*.mod src/auxiliaries/*.mod)


help:
	@echo "usage: make [executable]"
	@echo ""
	@echo "supported executables:"
	@echo "    xmeshfem3D"
	@echo "    xspecfem3D"
	@echo "    xcreate_header_file"
	@echo "    xcheck_buffers_1D"
	@echo "    xcheck_buffers_2D"
	@echo "    xcheck_buffers_corners_chunks"
	@echo "    xcheck_buffers_faces_chunks"
	@echo "    xcombine_vol_data"
	@echo "    xcombine_vol_data_vtk"
	@echo "    xcombine_surf_data"
	@echo "    xconvolve_source_timefunction"
	@echo "    xcreate_movie_AVS_DX"
	@echo "    xcreate_movie_GMT_global"
	@echo ""

